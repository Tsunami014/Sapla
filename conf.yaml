version: 1

script: |
  # remove any previous AppDir
  rm -rf AppDir || true

  # create destination dirs
  mkdir -p "$TARGET_APPDIR/usr/bin"
  mkdir -p "$TARGET_APPDIR/usr/share/icons/hicolor/256x256/apps"
  mkdir -p "$TARGET_APPDIR/usr/share/applications"

  # copy the executable and the companion .so next to it
  cp "$SOURCE_DIR/build/Sapla" "$TARGET_APPDIR/usr/bin/Sapla"
  cp "$SOURCE_DIR/build/libbuiltinGame.so" "$TARGET_APPDIR/usr/bin/libbuiltinGame.so"
  chmod +x "$TARGET_APPDIR/usr/bin/Sapla"

  # copy desktop/icon if you have them (adjust path if needed)
  # cp "$SOURCE_DIR/path/to/icon.png" "$TARGET_APPDIR/usr/share/icons/hicolor/256x256/apps/sapla.png"
  # cp "$SOURCE_DIR/path/to/Sapla.desktop" "$TARGET_APPDIR/usr/share/applications/Sapla.desktop"

AppDir:
  path: ./AppDir

  app_info:
    id: tsu.nami.sapla
    name: Sapla
    version: "4.0.0"
    exec: usr/bin/Sapla
    exec_args: $@

  # small set of excludes so AppImage size is reasonable
  files:
    exclude:
      - usr/share/man
      - usr/share/doc
      - usr/include

  runtime:
    env:
      APPDIR_LIBRARY_PATH: $APPDIR/usr/lib:$APPDIR/lib

AppImage:
  arch: x86_64

